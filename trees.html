<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>Pythagorean Trees</title>
    <!-- link to the last version of babylon -->
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
    <style>

</style>
</head>
<body onload="init();">
  <canvas id="demoCanvas" width="500" height="300"></canvas>
  <script>
    var square_length = 60;
    var CANVAS_WIDTH=500;
    var CANVAS_HEIGHT=300;

    var init_x = CANVAS_WIDTH/2;
    var init_y = -250;
    var iters = 0;
    var MAX_ITERS = 7;
    var TRI_ANGLE = Math.PI/6;

    function init() {
        var stage = new createjs.Stage("demoCanvas");
        stage.scaleY=-1;

        var g = new createjs.Graphics();
        g.setStrokeStyle(1);
        g.beginStroke("#000000");
        g.beginFill("red");

        var vec = {x: square_length, y: 0};

        drawSquare({x: init_x, y: init_y}, vec, square_length, stage, iters);

    }

    function drawSquare(pos, vec, length, stage, iters) {
        var line = new createjs.Shape();
        stage.addChild(line);
        line.graphics.setStrokeStyle(1).beginStroke("rgba(0,0,0,1)");

        line.graphics.moveTo(pos.x, pos.y);
        var x = pos.x; var y = pos.y;
        var rv = Object.assign({}, vec);
        for(var i=0; i<4; i++) {
            x = x+rv.x;
            y = y+rv.y;
            line.graphics.lineTo(x, y);
            rv = rotate90(rv);
        }
        //undo the last rotation
        rv = rotate90Clock(rv);
        // goes to top left corner
        rv = {x: -rv.x, y: -rv.y};
        line.graphics.endStroke();
        stage.update();
        var newPos = {x: x+rv.x, y: y+rv.y};

        // vector in direction of other top corner of square
        rv = rotate90Clock(rv);
        drawTriangle(newPos, rv, length, stage, iters);
    }

    /* take {x, y} vector */
    function rotate90(vec) {
        return {x: -vec.y, y: vec.x};
    }

    function rotateRad(vec, rad) {
        return {
            x: vec.x*Math.cos(rad) - vec.y*Math.sin(rad), 
            y: vec.x*Math.sin(rad) + vec.y*Math.cos(rad)};
    }

    function rotate90Clock(vec) {
        return {x: vec.y, y: -vec.x};
    }

    function scaleVec(vec, scale) {
        var norm = getNorm(vec);
        var newVec = {x: vec.x/norm, y: vec.y/norm};
        newVec.x = newVec.x*scale;
        newVec.y = newVec.y*scale;
        return newVec;
    }

    function getNorm(vec) {
        return Math.sqrt(
            Math.pow(vec.x, 2) + Math.pow(vec.y, 2));
    }
    /* the input vector is in the direction along top of the last square */
    function drawTriangle(pos, vec, length, stage, iters) {
        var line = new createjs.Shape();
        stage.addChild(line);
        line.graphics.setStrokeStyle(1).beginStroke("rgba(0,0,0,1)");

        var x = pos.x, y = pos.y;
        line.graphics.moveTo(x, y);

        // create the left part of the triangle
        var leftVec = rotateRad(vec, TRI_ANGLE);
        var l_length = length*Math.cos(TRI_ANGLE);
        leftVec = scaleVec(leftVec, l_length);

        x = x+leftVec.x; y = y+leftVec.y;
        var topPt = {x: x, y: y};
        line.graphics.lineTo(x, y);
        
        // create the right part of the triangle
        var rightVec = {
            x: pos.x + vec.x - x,
            y: pos.y + vec.y - y
        };
        x = pos.x + vec.x; y = pos.y + vec.y;
        line.graphics.lineTo(x, y);

        line.graphics.endStroke();
        stage.update();

        iters++;
        if(iters > MAX_ITERS) {
            return;
        }

        drawSquare(pos, leftVec, l_length, stage, iters);
        drawSquare(topPt, rightVec, getNorm(rightVec), stage, iters);
    }
  </script>`
</body>
</html>
